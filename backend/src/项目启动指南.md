# CodingTracker é¡¹ç›®å¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Java**: JDK 17 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Maven**: 3.8.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æ•°æ®åº“**: MySQL 8.0 æˆ– PostgreSQL 13+
- **IDE**: IntelliJ IDEA æˆ– Eclipse (æ¨è IntelliJ IDEA)

### 1. é¡¹ç›®å…‹éš†å’Œé…ç½®

```bash
# å…‹éš†é¡¹ç›®
git clone <your-repository-url>
cd coding-tracker

# è¿›å…¥é‡æ„åçš„ç›®å½•
cd backend/src1
```

### 2. æ•°æ®åº“é…ç½®

#### MySQLé…ç½®
```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE coding_tracker CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·ï¼ˆå¯é€‰ï¼‰
CREATE USER 'coding_tracker'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON coding_tracker.* TO 'coding_tracker'@'localhost';
FLUSH PRIVILEGES;
```

#### é…ç½®æ–‡ä»¶è®¾ç½®
ç¼–è¾‘ `src/main/resources/application.properties`:

```properties
# æ•°æ®åº“é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/coding_tracker?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf8mb4
spring.datasource.username=coding_tracker
spring.datasource.password=your_password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPAé…ç½®
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# JWTé…ç½®
app.jwt.secret=your-secret-key-here
app.jwt.expiration=86400000

# æ–‡ä»¶ä¸Šä¼ é…ç½®
app.upload.avatar.dir=uploads/avatars
app.upload.avatar.base-url=http://localhost:8080
app.upload.avatar.max-size=2097152

# CORSé…ç½®
app.cors.allowed-origins=http://localhost:3000,http://127.0.0.1:3000
```

### 3. ç¼–è¯‘å’Œå¯åŠ¨

```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean compile

# è¿è¡Œé¡¹ç›®
mvn spring-boot:run

# æˆ–è€…æ‰“åŒ…åè¿è¡Œ
mvn clean package
java -jar target/coding-tracker-2.0.0.jar
```

### 4. éªŒè¯å¯åŠ¨

å¯åŠ¨æˆåŠŸåï¼Œè®¿é—®ä»¥ä¸‹URLéªŒè¯ï¼š

- **APIæ–‡æ¡£**: http://localhost:8080/swagger-ui/index.html
- **å¥åº·æ£€æŸ¥**: http://localhost:8080/actuator/health
- **APIåŸºç¡€è·¯å¾„**: http://localhost:8080/api/v1

## ğŸ“‹ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

### ç›®å½•ç»“æ„
```
src1/
â”œâ”€â”€ main/java/com/codingtracker/
â”‚   â”œâ”€â”€ api/                    # APIå±‚ - RESTæ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ v1/controller/     
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒä¸šåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ domain/           # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/       # å®ä½“ç±»
â”‚   â”‚   â”‚   â””â”€â”€ repository/   # ä»“å‚¨æ¥å£
â”‚   â”‚   â””â”€â”€ service/          # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚       â””â”€â”€ impl/         # æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ infrastructure/        # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ security/         # å®‰å…¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ external/         # å¤–éƒ¨æœåŠ¡
â”‚   â”œâ”€â”€ shared/               # å…±äº«å±‚
â”‚   â”‚   â”œâ”€â”€ dto/              # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ exception/        # å¼‚å¸¸å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ util/             # å·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ constant/         # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ config/               # é…ç½®ç±»
â””â”€â”€ main/resources/
    â”œâ”€â”€ application.properties
    â””â”€â”€ static/
```

### æ ¸å¿ƒç»„ä»¶

#### 1. å®ä½“æ¨¡å‹
- **User**: ç”¨æˆ·å®ä½“ï¼ˆèšåˆæ ¹ï¼‰
- **UserOJ**: OJè´¦å·å®ä½“
- **UserTag**: ç”¨æˆ·æ ‡ç­¾å®ä½“
- **OJPlatform**: OJå¹³å°æšä¸¾

#### 2. æœåŠ¡å±‚
- **UserService**: ç”¨æˆ·ç®¡ç†æœåŠ¡
- **UserAuthService**: è®¤è¯æœåŠ¡
- **UserOJService**: OJè´¦å·æœåŠ¡

#### 3. æ§åˆ¶å™¨
- **AuthController**: è®¤è¯ç›¸å…³API
- **UserController**: ç”¨æˆ·ç®¡ç†API
- **UserOJController**: OJè´¦å·ç®¡ç†API

## ğŸ” è®¤è¯å’Œæƒé™

### JWTè®¤è¯æµç¨‹

1. **ç”¨æˆ·æ³¨å†Œ/ç™»å½•** â†’ è·å–JWTä»¤ç‰Œ
2. **APIè¯·æ±‚** â†’ åœ¨Headerä¸­æºå¸¦ä»¤ç‰Œ
3. **æœåŠ¡ç«¯éªŒè¯** â†’ è§£æç”¨æˆ·ä¿¡æ¯å’Œæƒé™
4. **æƒé™æ£€æŸ¥** â†’ éªŒè¯æ“ä½œæƒé™

### æƒé™è§’è‰²

- **USER**: æ™®é€šç”¨æˆ·
- **ADMIN**: ç®¡ç†å‘˜
- **SUPER_ADMIN**: è¶…çº§ç®¡ç†å‘˜

### APIè®¤è¯ä½¿ç”¨

```bash
# 1. ç”¨æˆ·ç™»å½•è·å–ä»¤ç‰Œ
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "password123"
  }'

# å“åº”ç¤ºä¾‹
{
  "success": true,
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "username": "admin",
    "roles": ["SUPER_ADMIN"]
  }
}

# 2. ä½¿ç”¨ä»¤ç‰Œè®¿é—®å—ä¿æŠ¤çš„API
curl -X GET http://localhost:8080/api/v1/users \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..."
```

## ğŸ“š APIä½¿ç”¨ç¤ºä¾‹

### 1. ç”¨æˆ·æ³¨å†Œ

```bash
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "newuser",
    "password": "password123",
    "confirmPassword": "password123",
    "realName": "æ–°ç”¨æˆ·",
    "email": "newuser@example.com",
    "major": "è®¡ç®—æœºç§‘å­¦"
  }'
```

### 2. è·å–ç”¨æˆ·åˆ—è¡¨

```bash
curl -X GET "http://localhost:8080/api/v1/users?page=0&size=10" \
  -H "Authorization: Bearer <your-token>"
```

### 3. æ·»åŠ OJè´¦å·

```bash
curl -X POST http://localhost:8080/api/v1/users/1/oj-accounts \
  -H "Authorization: Bearer <your-token>" \
  -H "Content-Type: application/json" \
  -d '{
    "platform": "CODEFORCES",
    "accountName": "your_cf_username"
  }'
```

### 4. ä¸Šä¼ å¤´åƒ

```bash
curl -X POST http://localhost:8080/api/v1/users/1/avatar \
  -H "Authorization: Bearer <your-token>" \
  -F "file=@avatar.jpg"
```

## ğŸ”§ å¼€å‘æŒ‡å—

### 1. æ·»åŠ æ–°çš„APIç«¯ç‚¹

#### åˆ›å»ºè¯·æ±‚DTO
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class YourRequest {
    @NotBlank(message = "å­—æ®µä¸èƒ½ä¸ºç©º")
    private String field;
}
```

#### åˆ›å»ºå“åº”DTO
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class YourResponse {
    private String result;
}
```

#### åˆ›å»ºæ§åˆ¶å™¨æ–¹æ³•
```java
@RestController
@RequestMapping("/api/v1/your-resource")
@RequiredArgsConstructor
@Slf4j
public class YourController {
    
    private final YourService yourService;
    
    @PostMapping
    @Operation(summary = "åˆ›å»ºèµ„æº")
    public ResponseEntity<ApiResponse<YourResponse>> create(@Valid @RequestBody YourRequest request) {
        YourResponse response = yourService.create(request);
        return ResponseEntity.ok(ApiResponse.success(response, "åˆ›å»ºæˆåŠŸ"));
    }
}
```

### 2. æ·»åŠ æ–°çš„ä¸šåŠ¡å®ä½“

#### åˆ›å»ºå®ä½“ç±»
```java
@Entity
@Table(name = "your_table")
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class YourEntity extends BaseEntity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;
    
    @Column(nullable = false)
    private String name;
}
```

#### åˆ›å»ºä»“å‚¨æ¥å£
```java
public interface YourRepository extends JpaRepository<YourEntity, Integer> {
    Optional<YourEntity> findByName(String name);
    boolean existsByName(String name);
}
```

#### åˆ›å»ºæœåŠ¡æ¥å£å’Œå®ç°
```java
public interface YourService {
    YourResponse create(YourRequest request);
    Optional<YourResponse> findByName(String name);
}

@Service
@Transactional
@RequiredArgsConstructor
@Slf4j
public class YourServiceImpl implements YourService {
    
    private final YourRepository yourRepository;
    
    @Override
    public YourResponse create(YourRequest request) {
        // ä¸šåŠ¡é€»è¾‘å®ç°
        return YourResponse.builder().build();
    }
}
```

### 3. æ•°æ®åº“è¿ç§»

é¡¹ç›®ä½¿ç”¨Hibernateè‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„ï¼Œå¯¹äºç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š

1. è®¾ç½® `spring.jpa.hibernate.ddl-auto=validate`
2. ä½¿ç”¨Flywayæˆ–Liquibaseè¿›è¡Œæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
3. æ‰‹åŠ¨åˆ›å»ºå’Œç»´æŠ¤SQLè¿ç§»è„šæœ¬

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=UserServiceImplTest

# è¿è¡Œé›†æˆæµ‹è¯•
mvn test -Dtest="*IntegrationTest"

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
mvn test jacoco:report
```

### æµ‹è¯•è¦†ç›–ç‡

æµ‹è¯•æŠ¥å‘Šä½ç½®ï¼š`target/site/jacoco/index.html`

### APIæµ‹è¯•

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·è¿›è¡ŒAPIæµ‹è¯•ï¼š

1. **Swagger UI**: http://localhost:8080/swagger-ui/index.html
2. **Postman**: å¯¼å…¥Swaggeræ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•é›†åˆ
3. **curl**: ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æµ‹è¯•

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### åº”ç”¨ç›‘æ§

é¡¹ç›®é›†æˆäº†Spring Boot Actuatorï¼Œæä¾›ä»¥ä¸‹ç›‘æ§ç«¯ç‚¹ï¼š

- `/actuator/health` - å¥åº·æ£€æŸ¥
- `/actuator/info` - åº”ç”¨ä¿¡æ¯
- `/actuator/metrics` - åº”ç”¨æŒ‡æ ‡
- `/actuator/env` - ç¯å¢ƒå˜é‡

### æ—¥å¿—é…ç½®

é»˜è®¤æ—¥å¿—çº§åˆ«é…ç½®ï¼š
```properties
# æ—¥å¿—é…ç½®
logging.level.com.codingtracker=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
```

### æ€§èƒ½ç›‘æ§

å»ºè®®é›†æˆä»¥ä¸‹å·¥å…·ï¼š
- **Micrometer** + **Prometheus** + **Grafana**
- **Spring Boot Admin**
- **APMå·¥å…·** (å¦‚New Relic, AppDynamics)

## ğŸ“¦ éƒ¨ç½²

### 1. æ‰“åŒ…åº”ç”¨

```bash
# åˆ›å»ºå¯æ‰§è¡ŒJAR
mvn clean package -DskipTests

# æ„å»ºDockeré•œåƒ
docker build -t coding-tracker:2.0.0 .
```

### 2. ç¯å¢ƒé…ç½®

#### å¼€å‘ç¯å¢ƒ
```properties
spring.profiles.active=dev
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
```

#### ç”Ÿäº§ç¯å¢ƒ
```properties
spring.profiles.active=prod
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
logging.level.com.codingtracker=INFO
```

### 3. Dockeréƒ¨ç½²

```dockerfile
FROM openjdk:17-jdk-slim

WORKDIR /app
COPY target/coding-tracker-2.0.0.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]
```

```bash
# æ„å»ºå’Œè¿è¡Œ
docker build -t coding-tracker .
docker run -p 8080:8080 -e SPRING_PROFILES_ACTIVE=prod coding-tracker
```

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. å¯åŠ¨å¤±è´¥

**é—®é¢˜**: æ•°æ®åº“è¿æ¥å¤±è´¥
**è§£å†³**: æ£€æŸ¥æ•°æ®åº“é…ç½®å’Œè¿æ¥ä¿¡æ¯

**é—®é¢˜**: ç«¯å£å†²çª
**è§£å†³**: ä¿®æ”¹`server.port`é…ç½®æˆ–åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹

### 2. è®¤è¯é—®é¢˜

**é—®é¢˜**: JWTä»¤ç‰Œæ— æ•ˆ
**è§£å†³**: æ£€æŸ¥ä»¤ç‰Œæ ¼å¼å’Œè¿‡æœŸæ—¶é—´

**é—®é¢˜**: æƒé™ä¸è¶³
**è§£å†³**: ç¡®è®¤ç”¨æˆ·è§’è‰²å’ŒAPIæƒé™è¦æ±‚

### 3. APIè°ƒç”¨é—®é¢˜

**é—®é¢˜**: CORSé”™è¯¯
**è§£å†³**: æ£€æŸ¥CORSé…ç½®å’Œè¯·æ±‚æ¥æº

**é—®é¢˜**: å‚æ•°éªŒè¯å¤±è´¥
**è§£å†³**: ç¡®è®¤è¯·æ±‚å‚æ•°æ ¼å¼å’ŒéªŒè¯è§„åˆ™

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£èµ„æº

- **APIæ–‡æ¡£**: http://localhost:8080/swagger-ui/index.html
- **æ¶æ„æ–‡æ¡£**: 
  - [APIå±‚è¯´æ˜](./main/java/com/codingtracker/api/README.md)
  - [æ ¸å¿ƒä¸šåŠ¡å±‚è¯´æ˜](./main/java/com/codingtracker/core/README.md)
  - [åŸºç¡€è®¾æ–½å±‚è¯´æ˜](./main/java/com/codingtracker/infrastructure/README.md)
  - [å…±äº«å±‚è¯´æ˜](./main/java/com/codingtracker/shared/README.md)

### è”ç³»æ–¹å¼

- **é¡¹ç›®ä»“åº“**: [GitHub Repository]
- **é—®é¢˜åé¦ˆ**: [GitHub Issues]
- **æŠ€æœ¯è®¨è®º**: [Discussion Forum]

## ğŸ”„ ç‰ˆæœ¬ä¿¡æ¯

### å½“å‰ç‰ˆæœ¬: 2.0.0

**ä¸»è¦ç‰¹æ€§**:
- âœ… é‡æ„ä¸ºDDDå››å±‚æ¶æ„
- âœ… JWTæ— çŠ¶æ€è®¤è¯
- âœ… RESTful APIè®¾è®¡
- âœ… å®Œæ•´çš„å¼‚å¸¸å¤„ç†
- âœ… OpenAPI 3.0æ–‡æ¡£
- âœ… åˆ†å±‚æ¶æ„æ–‡æ¡£

**ä¸‹ä¸€ç‰ˆæœ¬è®¡åˆ’**:
- ğŸ”„ ç¼“å­˜é›†æˆ
- ğŸ”„ æ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒ
- ğŸ”„ æ•°æ®åˆ†æåŠŸèƒ½
- ğŸ”„ å¤šç§Ÿæˆ·æ”¯æŒ

---

**æ³¨æ„**: è¿™æ˜¯é‡æ„åçš„ç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥æŠ•å…¥ä½¿ç”¨ã€‚å¦‚éœ€æŠ€æœ¯æ”¯æŒï¼Œè¯·å‚è€ƒå„å±‚çš„è¯¦ç»†æ–‡æ¡£æˆ–æäº¤Issueã€‚ 